<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>hexo-use | mhen</title>
  <meta name="keywords" content="">
  <meta name="description" content="hexo-use | mhen">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="golangå­¦ä¹ goè¯­è¨€ä¸»è¦ç‰¹æ€§  è‡ªåŠ¨åƒåœ¾å›æ”¶ æ›´ä¸°å¯Œçš„å†…ç½®ç±»å‹ å‡½æ•°å¤šè¿”å›å€¼ é”™è¯¯å¤„ç† åŒ¿åå‡½æ•°å’Œé—­åŒ… ç±»å‹å’Œæ¥å£ å¹¶å‘ç¼–ç¨‹ åå°„ è¯­è¨€äº¤äº’æ€§  goåŸºç¡€ åŒ…å£°æ˜ packageï¼Œæ¯ä¸ªgoåº”ç”¨ç¨‹åºéƒ½åŒ…å«ä¸€ä¸ªåä¸ºmainçš„åŒ…  å¼•å…¥åŒ… import  å‡½æ•° funcï¼Œmainå‡½æ•°æ˜¯æ¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå¿…é¡»åŒ…å«çš„ï¼Œä¸€èˆ¬æ˜¯å¯åŠ¨åç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå¦‚æœæœ‰init()å‡½æ•°ä¼šå…ˆæ‰§è¡Œè¯¥å‡½æ•°  å˜é‡  è¯­å¥ &amp;amp">
<meta property="og:type" content="article">
<meta property="og:title" content="golang">
<meta property="og:url" content="http://example.com/2023/10/27/golang/index.html">
<meta property="og:site_name" content="mhen">
<meta property="og:description" content="golangå­¦ä¹ goè¯­è¨€ä¸»è¦ç‰¹æ€§  è‡ªåŠ¨åƒåœ¾å›æ”¶ æ›´ä¸°å¯Œçš„å†…ç½®ç±»å‹ å‡½æ•°å¤šè¿”å›å€¼ é”™è¯¯å¤„ç† åŒ¿åå‡½æ•°å’Œé—­åŒ… ç±»å‹å’Œæ¥å£ å¹¶å‘ç¼–ç¨‹ åå°„ è¯­è¨€äº¤äº’æ€§  goåŸºç¡€ åŒ…å£°æ˜ packageï¼Œæ¯ä¸ªgoåº”ç”¨ç¨‹åºéƒ½åŒ…å«ä¸€ä¸ªåä¸ºmainçš„åŒ…  å¼•å…¥åŒ… import  å‡½æ•° funcï¼Œmainå‡½æ•°æ˜¯æ¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå¿…é¡»åŒ…å«çš„ï¼Œä¸€èˆ¬æ˜¯å¯åŠ¨åç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå¦‚æœæœ‰init()å‡½æ•°ä¼šå…ˆæ‰§è¡Œè¯¥å‡½æ•°  å˜é‡  è¯­å¥ &amp;amp">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-10-27T05:13:53.000Z">
<meta property="article:modified_time" content="2023-10-31T07:41:32.717Z">
<meta property="article:author" content="mhen">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 6.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>mhen</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(29)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="å·¥å…·">
                        <i class="fold iconfont icon-right"></i>
                        
                        å·¥å…·
                        <small>(3)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="å·¥å…·<--->git">
                                        
                                        git
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="å·¥å…·<--->hexo">
                                        
                                        hexo
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="å·¥å…·<--->idea">
                                        <i class="fold iconfont icon-right"></i>
                                        
                                        idea
                                        
                                            <small>(1
                                                )</small>
                                        
                                    </div>
                                    
                                        <ul class="sub hide">
                                            
                                                <li>
                                                    <div data-rel="å·¥å…·<--->ideadebug">
                                                        
                                                        debug
                                                        
                                                            <small>(1)</small>
                                                        
                                                    </div>
                                                </li>
                                            
                                        </ul>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="æ•°æ®åº“">
                        <i class="fold iconfont icon-right"></i>
                        
                        æ•°æ®åº“
                        <small>(15)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="æ•°æ®åº“<--->mysql">
                                        
                                        mysql
                                        
                                            <small>(14
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="å¤§æ•°æ®å¼€å‘">
                        <i class="fold iconfont icon-right"></i>
                        
                        å¤§æ•°æ®å¼€å‘
                        <small>(5)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="å¤§æ•°æ®å¼€å‘<--->hadoop">
                                        
                                        hadoop
                                        
                                            <small>(3
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                                <li>
                                    <div data-rel="å¤§æ•°æ®å¼€å‘<--->hive">
                                        
                                        hive
                                        
                                            <small>(2
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
                <li>
                    <div data-rel="golang">
                        
                        golang
                        <small>(1)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                <li>
                    <div data-rel="java">
                        <i class="fold iconfont icon-right"></i>
                        
                        java
                        <small>(2)</small>
                        
                    </div>
                    
                        <ul class="sub hide">
                            
                                <li>
                                    <div data-rel="java<--->jvm">
                                        
                                        jvm
                                        
                                            <small>(2
                                                )</small>
                                        
                                    </div>
                                    
                                </li>
                            
                        </ul>
                    
                </li>
            
        
    
        
            
        
    
        
            
                <li>
                    <div data-rel="leetcode">
                        
                        leetcode
                        <small>(2)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="Mybatis">
                        
                        Mybatis
                        <small>(1)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="29">
<input type="hidden" id="yelog_site_word_count" value="19.1k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åŠ¨æ€è§„åˆ’</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ç±»åŠ è½½</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>bug</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>construct</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>debug</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>git</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>idea</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jvm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mysql</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="All golang "
           href="/2023/10/27/golang/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="golang">golang</span>
            <span class="post-date" title="2023-10-27 13:13:53">2023/10/27</span>
        </a>
        
        
        <a  class="All å¤§æ•°æ®å¼€å‘ hive "
           href="/2023/09/12/hive/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hive">hive</span>
            <span class="post-date" title="2023-09-12 15:18:18">2023/09/12</span>
        </a>
        
        
        <a  class="All å¤§æ•°æ®å¼€å‘ hadoop "
           href="/2023/09/12/yarn/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="yarn">yarn</span>
            <span class="post-date" title="2023-09-12 09:47:14">2023/09/12</span>
        </a>
        
        
        <a  class="All å¤§æ•°æ®å¼€å‘ hadoop "
           href="/2023/09/12/mapreduce/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mapreduce">mapreduce</span>
            <span class="post-date" title="2023-09-12 09:29:03">2023/09/12</span>
        </a>
        
        
        <a  class="All å¤§æ•°æ®å¼€å‘ hadoop "
           href="/2023/09/07/hadoop-server/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hadoop_server">hadoop_server</span>
            <span class="post-date" title="2023-09-07 13:38:52">2023/09/07</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/09/05/sql-lock/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sql_lock">sql_lock</span>
            <span class="post-date" title="2023-09-05 14:35:13">2023/09/05</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/09/05/sql-trigger/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sql_trigger">sql_trigger</span>
            <span class="post-date" title="2023-09-05 10:29:54">2023/09/05</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/09/04/sql-stored/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sql_stored">sql_stored</span>
            <span class="post-date" title="2023-09-04 10:38:27">2023/09/04</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/09/01/sql-view/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sql_view">sql_view</span>
            <span class="post-date" title="2023-09-01 12:59:44">2023/09/01</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/09/01/sql-optimize/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sql_optimize">sql_optimize</span>
            <span class="post-date" title="2023-09-01 09:30:42">2023/09/01</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/29/mysql-index/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-index">mysql-index</span>
            <span class="post-date" title="2023-08-29 10:36:41">2023/08/29</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/29/mysql-engine/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-storage-engine">mysql-storage-engine</span>
            <span class="post-date" title="2023-08-29 09:37:33">2023/08/29</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/28/transaction-sql/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="transaction_sql">transaction_sql</span>
            <span class="post-date" title="2023-08-28 17:00:31">2023/08/28</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/28/select-tables/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="select_tables">select_tables</span>
            <span class="post-date" title="2023-08-28 13:53:25">2023/08/28</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ "
           href="/2023/08/28/constraint/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="constraint">constraint</span>
            <span class="post-date" title="2023-08-28 12:25:25">2023/08/28</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/28/mysql-funs/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-funs">mysql-funs</span>
            <span class="post-date" title="2023-08-28 09:19:42">2023/08/28</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/25/mysql-dcl/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-dcl">mysql-dcl</span>
            <span class="post-date" title="2023-08-25 18:32:55">2023/08/25</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/25/mysql-dql/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-dql">mysql-dql</span>
            <span class="post-date" title="2023-08-25 18:32:47">2023/08/25</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/25/mysql-dml/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-dml">mysql-dml</span>
            <span class="post-date" title="2023-08-25 18:14:33">2023/08/25</span>
        </a>
        
        
        <a  class="All æ•°æ®åº“ mysql "
           href="/2023/08/25/mysql-ddl/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mysql-ddl">mysql-ddl</span>
            <span class="post-date" title="2023-08-25 16:41:00">2023/08/25</span>
        </a>
        
        
        <a  class="All leetcode "
           href="/2023/06/12/constructTree/"
           data-tag="construct"
           data-author="" >
            <span class="post-title" title="constructTree">constructTree</span>
            <span class="post-date" title="2023-06-12 12:35:42">2023/06/12</span>
        </a>
        
        
        <a  class="All java jvm "
           href="/2023/05/24/jvm-class-loading-process/"
           data-tag="ç±»åŠ è½½"
           data-author="" >
            <span class="post-title" title="jvm-class-loading-process">jvm-class-loading-process</span>
            <span class="post-date" title="2023-05-24 15:56:37">2023/05/24</span>
        </a>
        
        
        <a  class="All java jvm "
           href="/2023/05/23/jvm-learn/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="jvm-learn">jvm-learn</span>
            <span class="post-date" title="2023-05-23 16:32:08">2023/05/23</span>
        </a>
        
        
        <a  class="All å·¥å…· idea debug "
           href="/2023/05/12/debug-skill/"
           data-tag="debug,idea"
           data-author="" >
            <span class="post-title" title="debug-skill">debug-skill</span>
            <span class="post-date" title="2023-05-12 12:35:32">2023/05/12</span>
        </a>
        
        
        <a  class="All å·¥å…· git "
           href="/2023/05/10/git-learning/"
           data-tag="git"
           data-author="" >
            <span class="post-title" title="git-learning">git-learning</span>
            <span class="post-date" title="2023-05-10 18:14:02">2023/05/10</span>
        </a>
        
        
        <a  class="All Mybatis "
           href="/2023/05/10/MybatisMapperXML%E6%96%87%E4%BB%B6%E6%8A%A5%E9%94%99/"
           data-tag="bug"
           data-author="" >
            <span class="post-title" title="Mybatis:MapperXMLæ–‡ä»¶æŠ¥é”™(Unable to resolve table &#39;limit&#39;)">Mybatis:MapperXMLæ–‡ä»¶æŠ¥é”™(Unable to resolve table &#39;limit&#39;)</span>
            <span class="post-date" title="2023-05-10 14:33:43">2023/05/10</span>
        </a>
        
        
        <a  class="All leetcode "
           href="/2023/05/10/leetcode-%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/"
           data-tag="åŠ¨æ€è§„åˆ’"
           data-author="" >
            <span class="post-title" title="leetcode-æœ€é•¿å›æ–‡å­ä¸²">leetcode-æœ€é•¿å›æ–‡å­ä¸²</span>
            <span class="post-date" title="2023-05-10 10:51:43">2023/05/10</span>
        </a>
        
        
        <a  class="All å·¥å…· hexo "
           href="/2023/05/09/hexo-use/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="hexo-use">hexo-use</span>
            <span class="post-date" title="2023-05-09 22:03:50">2023/05/09</span>
        </a>
        
        
        <a  class="All å¤§æ•°æ®å¼€å‘ hive "
           href="/2023/05/09/Hive-SQL%E8%AF%AD%E6%B3%95%E5%A4%A7%E5%85%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hexo-use">hexo-use</span>
            <span class="post-date" title="2023-05-09 22:03:50">2023/05/09</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-Hive-SQLè¯­æ³•å¤§å…¨" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">hexo-use</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="å¤§æ•°æ®å¼€å‘">å¤§æ•°æ®å¼€å‘</a> > 
            
            <a  data-rel="å¤§æ•°æ®å¼€å‘&lt;---&gt;hive">hive</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2023-09-13 15:52:28'>2023-05-09 22:03</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:4.6k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hive-SQL-%E8%AF%AD%E6%B3%95%E5%A4%A7%E5%85%A8"><span class="toc-text">Hive SQL è¯­æ³•å¤§å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%AF%AD%E6%B3%95%E6%8F%8F%E8%BF%B0%E8%AF%B4%E6%98%8E"><span class="toc-text">åŸºäºè¯­æ³•æè¿°è¯´æ˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-text">æ•°æ®åº“æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">åˆ›å»ºæ•°æ®åº“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">åˆ é™¤æ•°æ®åº“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E6%94%B9LOCATION"><span class="toc-text">æ•°æ®åº“ä¿®æ”¹LOCATION</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">é€‰æ‹©æ•°æ®åº“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">è¡¨æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BB%BA%E8%A1%A8"><span class="toc-text">åŸºç¡€å»ºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%85%B6%E5%AE%83%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84%E5%BB%BA%E8%A1%A8"><span class="toc-text">åŸºäºå…¶å®ƒè¡¨çš„ç»“æ„å»ºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%BB%BA%E8%A1%A8"><span class="toc-text">åŸºäºæŸ¥è¯¢ç»“æœå»ºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-text">åˆ é™¤è¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-text">ä¿®æ”¹è¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E6%93%8D%E4%BD%9C"><span class="toc-text">åˆ†åŒºæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E6%93%8D%E4%BD%9C"><span class="toc-text">åˆ†æ¡¶æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="toc-text">æ•°æ®åŠ è½½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-text">æ•°æ®å¯¼å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B"><span class="toc-text">å¤æ‚ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E7%9A%84%E8%AF%BE%E5%A0%82SQL%E8%AE%B0%E5%BD%95"><span class="toc-text">æ•°æ®æŸ¥è¯¢çš„è¯¾å ‚SQLè®°å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-text">åŸºæœ¬æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RLIKE"><span class="toc-text">RLIKE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION%E8%81%94%E5%90%88"><span class="toc-text">UNIONè”åˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sampling%E9%87%87%E6%A0%B7"><span class="toc-text">Samplingé‡‡æ ·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%88%97"><span class="toc-text">è™šæ‹Ÿåˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-text">å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BE%E4%BA%A4%E6%A1%88%E4%BE%8B%E6%93%8D%E4%BD%9CSQL"><span class="toc-text">ç¤¾äº¤æ¡ˆä¾‹æ“ä½œSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%88%97%E6%B3%A8%E9%87%8A%E3%80%81%E8%A1%A8%E6%B3%A8%E9%87%8A%E7%AD%89%E4%B9%B1%E7%A0%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">Hiveåˆ—æ³¨é‡Šã€è¡¨æ³¨é‡Šç­‰ä¹±ç è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-6 i,
    .toc-level-6 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Hive-SQL-è¯­æ³•å¤§å…¨"><a href="#Hive-SQL-è¯­æ³•å¤§å…¨" class="headerlink" title="Hive SQL è¯­æ³•å¤§å…¨"></a>Hive SQL è¯­æ³•å¤§å…¨</h1><h2 id="åŸºäºè¯­æ³•æè¿°è¯´æ˜"><a href="#åŸºäºè¯­æ³•æè¿°è¯´æ˜" class="headerlink" title="åŸºäºè¯­æ³•æè¿°è¯´æ˜"></a>åŸºäºè¯­æ³•æè¿°è¯´æ˜</h2><pre><code class="sql">CREATE DATABASE [IF NOT EXISTS] db_name [LOCATION] &#39;path&#39;;
SELECT expr, ... FROM tbl ORDER BY col_name [ASC | DESC]
(A | B | C)
</code></pre>
<p>å¦‚ä¸Šè¯­æ³•ï¼Œåœ¨è¯­æ³•æè¿°ä¸­å‡ºç°ï¼š</p>
<ul>
<li><p><code>[]</code>ï¼Œè¡¨ç¤ºå¯é€‰ï¼Œå¦‚ä¸Š<code>[LOCATION] </code>è¡¨ç¤ºå¯å†™ã€å¯ä¸å†™</p>
</li>
<li><p><code>|</code>ï¼Œè¡¨ç¤ºæˆ–ï¼Œå¦‚ä¸Š<code>ASC | DESC</code>ï¼Œè¡¨ç¤ºäºŒé€‰ä¸€</p>
</li>
<li><p>â€¦ï¼Œè¡¨ç¤ºåºåˆ—ï¼Œå³æœªå®Œç»“ï¼Œå¦‚ä¸Š<code>SELECT expr, ...</code> è¡¨ç¤ºåœ¨SELECTåå¯ä»¥è·Ÿå¤šä¸ª<code>exprï¼ˆæŸ¥è¯¢è¡¨è¾¾å¼ï¼‰</code>ï¼Œä»¥é€—å·éš”å¼€</p>
</li>
<li><p><code>()</code>ï¼Œè¡¨ç¤ºå¿…å¡«ï¼Œå¦‚ä¸Š(A | B | C)è¡¨ç¤ºæ­¤å¤„å¿…å¡«ï¼Œå¡«å…¥å†…å®¹åœ¨Aã€Bã€Cä¸­ä¸‰é€‰ä¸€</p>
</li>
</ul>
<h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><pre><code class="sql">CREATE DATABASE [IF NOT EXISTS] db_name [LOCATION &#39;path&#39;] [COMMENT database_comment];
</code></pre>
<ul>
<li><p><code>IF NOT EXISTS</code>ï¼Œå¦‚å­˜åœ¨åŒåæ•°æ®åº“<code>ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</code>ï¼Œå¦åˆ™<code>æ‰§è¡Œåˆ›å»ºæ•°æ®åº“</code>æ“ä½œ</p>
</li>
<li><p><code>[LOCATION]</code>ï¼Œè‡ªå®šä¹‰æ•°æ®åº“å­˜å‚¨ä½ç½®ï¼Œ<code>å¦‚ä¸å¡«å†™</code>ï¼Œé»˜è®¤æ•°æ®åº“åœ¨HDFSçš„è·¯å¾„ä¸ºï¼š<code>/user/hive/warehouse</code></p>
</li>
<li><p><code>[COMMENT database_comment]</code>ï¼Œå¯é€‰ï¼Œæ•°æ®åº“æ³¨é‡Š</p>
</li>
</ul>
<h3 id="åˆ é™¤æ•°æ®åº“"><a href="#åˆ é™¤æ•°æ®åº“" class="headerlink" title="åˆ é™¤æ•°æ®åº“"></a>åˆ é™¤æ•°æ®åº“</h3><pre><code class="sql">DROP DATABASE [IF EXISTS] db_name [CASCADE];
</code></pre>
<ul>
<li><code>[IF EXISTS]</code>ï¼Œå¯é€‰ï¼Œå¦‚æœå­˜åœ¨æ­¤æ•°æ®åº“æ‰§è¡Œåˆ é™¤ï¼Œä¸å­˜åœ¨ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</li>
<li><code>[CASCADE]</code>ï¼Œå¯é€‰ï¼Œçº§è”åˆ é™¤ï¼Œå³æ•°æ®åº“å†…å­˜åœ¨è¡¨ï¼Œä½¿ç”¨CASCADEå¯ä»¥å¼ºåˆ¶åˆ é™¤æ•°æ®åº“</li>
</ul>
<h3 id="æ•°æ®åº“ä¿®æ”¹LOCATION"><a href="#æ•°æ®åº“ä¿®æ”¹LOCATION" class="headerlink" title="æ•°æ®åº“ä¿®æ”¹LOCATION"></a>æ•°æ®åº“ä¿®æ”¹LOCATION</h3><pre><code class="sql">ALTER DATABASE database_name SET LOCATION hdfs_path;
</code></pre>
<p>&#x3D;&#x3D;ä¸ä¼šåœ¨HDFSå¯¹æ•°æ®åº“æ‰€åœ¨ç›®å½•è¿›è¡Œæ”¹åï¼Œåªæ˜¯ä¿®æ”¹locationåï¼Œæ–°åˆ›å»ºçš„è¡¨åœ¨æ–°çš„è·¯å¾„ï¼Œæ—§çš„ä¸å˜&#x3D;&#x3D;</p>
<h3 id="é€‰æ‹©æ•°æ®åº“"><a href="#é€‰æ‹©æ•°æ®åº“" class="headerlink" title="é€‰æ‹©æ•°æ®åº“"></a>é€‰æ‹©æ•°æ®åº“</h3><pre><code class="sql">USE db_name;
</code></pre>
<ul>
<li>é€‰æ‹©æ•°æ®åº“åï¼Œåç»­<code>SQL</code>æ“ä½œåŸºäºå½“å‰é€‰æ‹©çš„åº“æ‰§è¡Œ</li>
<li>å¦‚ä¸ä½¿ç”¨useï¼Œé»˜è®¤åœ¨<code>default</code>åº“æ‰§è¡Œ</li>
</ul>
<p><strong>è‹¥æƒ³åˆ‡æ¢å›ä½¿ç”¨defaultåº“</strong></p>
<pre><code class="sql">USE DEFAULT;
</code></pre>
<p><strong>æŸ¥è¯¢å½“å‰USEçš„æ•°æ®åº“</strong></p>
<pre><code class="sql">SELECT current_database();
</code></pre>
<h2 id="è¡¨æ“ä½œ"><a href="#è¡¨æ“ä½œ" class="headerlink" title="è¡¨æ“ä½œ"></a>è¡¨æ“ä½œ</h2><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><table>
<thead>
<tr>
<th><strong>åˆ†ç±»</strong></th>
<th><strong>ç±»å‹</strong></th>
<th><strong>æè¿°</strong></th>
<th><strong>å­—é¢é‡ç¤ºä¾‹</strong></th>
</tr>
</thead>
<tbody><tr>
<td>åŸå§‹ç±»å‹</td>
<td>BOOLEAN</td>
<td>true&#x2F;false</td>
<td>TRUE</td>
</tr>
<tr>
<td></td>
<td>TINYINT</td>
<td>1å­—èŠ‚çš„æœ‰ç¬¦å·æ•´æ•° -128~127</td>
<td>1Y</td>
</tr>
<tr>
<td></td>
<td>SMALLINT</td>
<td>2ä¸ªå­—èŠ‚çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œ-32768~32767</td>
<td>1S</td>
</tr>
<tr>
<td></td>
<td>INT</td>
<td>4ä¸ªå­—èŠ‚çš„å¸¦ç¬¦å·æ•´æ•°</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>BIGINT</td>
<td>8å­—èŠ‚å¸¦ç¬¦å·æ•´æ•°</td>
<td>1L</td>
</tr>
<tr>
<td></td>
<td>FLOAT</td>
<td>4å­—èŠ‚å•ç²¾åº¦æµ®ç‚¹æ•°1.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>DOUBLE</td>
<td>8å­—èŠ‚åŒç²¾åº¦æµ®ç‚¹æ•°</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>DEICIMAL</td>
<td>ä»»æ„ç²¾åº¦çš„å¸¦ç¬¦å·å°æ•°</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>STRING</td>
<td>å­—ç¬¦ä¸²ï¼Œå˜é•¿</td>
<td>â€œaâ€,â€™bâ€™</td>
</tr>
<tr>
<td></td>
<td>VARCHAR</td>
<td>å˜é•¿å­—ç¬¦ä¸²</td>
<td>â€œaâ€,â€™bâ€™</td>
</tr>
<tr>
<td></td>
<td>CHAR</td>
<td>å›ºå®šé•¿åº¦å­—ç¬¦ä¸²</td>
<td>â€œaâ€,â€™bâ€™</td>
</tr>
<tr>
<td></td>
<td>BINARY</td>
<td>å­—èŠ‚æ•°ç»„</td>
<td></td>
</tr>
<tr>
<td></td>
<td>TIMESTAMP</td>
<td>æ—¶é—´æˆ³ï¼Œæ¯«ç§’å€¼ç²¾åº¦</td>
<td>122327493795</td>
</tr>
<tr>
<td></td>
<td>DATE</td>
<td>æ—¥æœŸ</td>
<td>â€˜2016-03-29â€™</td>
</tr>
<tr>
<td></td>
<td></td>
<td>æ—¶é—´é¢‘ç‡é—´éš”</td>
<td></td>
</tr>
<tr>
<td>å¤æ‚ç±»å‹</td>
<td>ARRAY</td>
<td>æœ‰åºçš„çš„åŒç±»å‹çš„é›†åˆ</td>
<td>array(1,2)</td>
</tr>
<tr>
<td></td>
<td>MAP</td>
<td>key-value,keyå¿…é¡»ä¸ºåŸå§‹ç±»å‹ï¼Œvalueå¯ä»¥ä»»æ„ç±»å‹</td>
<td>map(â€˜aâ€™,1,â€™bâ€™,2)</td>
</tr>
<tr>
<td></td>
<td>STRUCT</td>
<td>å­—æ®µé›†åˆ,ç±»å‹å¯ä»¥ä¸åŒ</td>
<td>struct(â€˜1â€™,1,1.0), named_stract(â€˜col1â€™,â€™1â€™,â€™col2â€™,1,â€™clo3â€™,1.0)</td>
</tr>
<tr>
<td></td>
<td>UNION</td>
<td>åœ¨æœ‰é™å–å€¼èŒƒå›´å†…çš„ä¸€ä¸ªå€¼</td>
<td>create_union(1,â€™aâ€™,63)</td>
</tr>
</tbody></table>
<h3 id="åŸºç¡€å»ºè¡¨"><a href="#åŸºç¡€å»ºè¡¨" class="headerlink" title="åŸºç¡€å»ºè¡¨"></a>åŸºç¡€å»ºè¡¨</h3><pre><code class="sql">CREATE [EXTERNAL] TABLE tb_name
    (col_name col_type [COMMENT col_comment], ......)
    [COMMENT tb_comment]
    [PARTITIONED BY(col_name, col_type, ......)]
    [CLUSTERED BY(col_name, col_type, ......) INTO num BUCKETS]
    [ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;&#39;]
    [LOCATION &#39;path&#39;]
</code></pre>
<ul>
<li><p><code>[EXTERNAL]</code>ï¼Œå¤–éƒ¨è¡¨ï¼Œéœ€æ­é…</p>
<ul>
<li><p><code>[ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;&#39;]</code>æŒ‡å®šåˆ—åˆ†éš”ç¬¦</p>
</li>
<li><p><code>[LOCATION &#39;path&#39;]</code>è¡¨æ•°æ®è·¯å¾„</p>
</li>
<li><p>å¤–éƒ¨è¡¨ç¤ºæ„</p>
<pre><code class="sql">CREATE EXTERNAL TABLE test_ext(id int) COMMENT &#39;external table&#39; ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39; LOCATION &#39;hdfs://node1:8020/tmp/test_ext&#39;;
</code></pre>
</li>
</ul>
</li>
<li><p><code>[COMMENT tb_comment]</code>è¡¨æ³¨é‡Šï¼Œå¯é€‰</p>
</li>
<li><p><code>[PARTITIONED BY(col_name, col_type, ......)]</code>åŸºäºåˆ—åˆ†åŒº</p>
<pre><code class="sql">-- åˆ†åŒºè¡¨ç¤ºæ„
CREATE TABLE test_ext(id int) COMMENT &#39;partitioned table&#39; PARTITION BY(year string, month string, day string) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;
</code></pre>
</li>
<li><p><code>[CLUSTERED BY(col_name, col_type, ......)]</code>åŸºäºåˆ—åˆ†æ¡¶</p>
<pre><code class="sql">CREATE TABLE course (c_id string,c_name string,t_id string) CLUSTERED BY(c_id) INTO 3 BUCKETS ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;
</code></pre>
</li>
</ul>
<h3 id="åŸºäºå…¶å®ƒè¡¨çš„ç»“æ„å»ºè¡¨"><a href="#åŸºäºå…¶å®ƒè¡¨çš„ç»“æ„å»ºè¡¨" class="headerlink" title="åŸºäºå…¶å®ƒè¡¨çš„ç»“æ„å»ºè¡¨"></a>åŸºäºå…¶å®ƒè¡¨çš„ç»“æ„å»ºè¡¨</h3><pre><code class="sql">CREATE TABLE tbl_name LIKE other_tbl;
</code></pre>
<h3 id="åŸºäºæŸ¥è¯¢ç»“æœå»ºè¡¨"><a href="#åŸºäºæŸ¥è¯¢ç»“æœå»ºè¡¨" class="headerlink" title="åŸºäºæŸ¥è¯¢ç»“æœå»ºè¡¨"></a>åŸºäºæŸ¥è¯¢ç»“æœå»ºè¡¨</h3><pre><code class="sql">CREATE TABLE tbl_name AS SELECT ...;
</code></pre>
<h3 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h3><pre><code class="sql">DROP TABLE tbl;
</code></pre>
<h3 id="ä¿®æ”¹è¡¨"><a href="#ä¿®æ”¹è¡¨" class="headerlink" title="ä¿®æ”¹è¡¨"></a>ä¿®æ”¹è¡¨</h3><p><strong>é‡å‘½å</strong></p>
<pre><code class="sql">ALTER TABLE old RENAME TO new;
</code></pre>
<p><strong>ä¿®æ”¹å±æ€§</strong></p>
<pre><code class="sql">ALTER TABLE tbl SET TBLPROPERTIES(key=value);
-- å¸¸ç”¨å±æ€§
(&quot;EXTERNAL&quot;=&quot;TRUE&quot;) -- å†…å¤–éƒ¨è¡¨ï¼ŒTRUEè¡¨ç¤ºå¤–éƒ¨è¡¨
(&#39;comment&#39; = new_comment) -- ä¿®æ”¹è¡¨æ³¨é‡Š
-- å…¶ä½™å±æ€§å‚è§
https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-listTableProperties
</code></pre>
<p>å†…éƒ¨è¡¨ï¼šæœªè¢«externalä¿®é¥°çš„è¡¨ï¼Œæ™®é€šè¡¨ã€‚å­˜å‚¨ä½ç½®ç”±hive.metastore.warehouse.dirå‚æ•°å†³å®šï¼Œåˆ é™¤å†…éƒ¨è¡¨ä¼šç›´æ¥åˆ é™¤å…ƒæ•°æ®å’Œå­˜å‚¨æ•°æ®ï¼Œå› æ­¤ä¸é€‚åˆå’Œå…¶ä»–å·¥å…·å…±äº«æ•°æ®ã€‚</p>
<p>å¤–éƒ¨è¡¨ï¼šè¡¨æ•°æ®å¯ä»¥åœ¨ä»»ä½•ä½ç½®ï¼Œé€šè¿‡locationå…³é”®å­—æŒ‡å®šã€‚æ•°æ®å­˜å‚¨çš„ä¸åŒä¹Ÿä»£è¡¨äº†è¿™ä¸ªè¡¨åœ¨ç†å¿µä¸Šå¹¶ä¸æ˜¯hiveå†…éƒ¨ç®¡ç†çš„ï¼Œè€Œæ˜¯å¯ä»¥éšæ„ä¸´æ—¶è¿æ¥åˆ°å¤–éƒ¨æ•°æ®ä¸Šçš„ã€‚æ‰€ä»¥åœ¨åˆ é™¤å¤–éƒ¨è¡¨æ—¶ï¼Œä»…ä»…æ˜¯åˆ é™¤å…ƒæ•°æ®ï¼ˆè¡¨ä¿¡æ¯ï¼‰ï¼Œè€Œä¸ä¼šåˆ é™¤æ•°æ®æœ¬èº«</p>
<h3 id="åˆ†åŒºæ“ä½œ"><a href="#åˆ†åŒºæ“ä½œ" class="headerlink" title="åˆ†åŒºæ“ä½œ"></a>åˆ†åŒºæ“ä½œ</h3><p><strong>åˆ›å»ºåˆ†åŒºè¡¨</strong></p>
<pre><code class="sql">-- åˆ†åŒºè¡¨ç¤ºæ„
CREATE TABLE test_ext(id int) COMMENT &#39;partitioned table&#39; PARTITION BY(year string, month string, day string) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;
</code></pre>
<p><strong>æ·»åŠ åˆ†åŒº</strong></p>
<pre><code class="sql">ALTER TABLE tablename ADD PARTITION (partition_key=&#39;partition_value&#39;, ......);
</code></pre>
<p><strong>ä¿®æ”¹åˆ†åŒºå€¼</strong></p>
<pre><code class="sql">ALTER TABLE tablename PARTITION (partition_key=&#39;old_partition_value&#39;) RENAME TO PARTITION (partition_key=&#39;new_partition_value&#39;);
</code></pre>
<p>&#x3D;&#x3D;æ³¨æ„&#x3D;&#x3D;</p>
<p>åªä¼šåœ¨å…ƒæ•°æ®ä¸­ä¿®æ”¹ï¼Œä¸ä¼šåŒæ­¥ä¿®æ”¹HDFSè·¯å¾„å—ï¼Œå¦‚ï¼š</p>
<ul>
<li>åŸåˆ†åŒºè·¯å¾„ä¸ºï¼š<code>/user/hive/warehouse/test.db/test_table/month=201910</code>ï¼Œåˆ†åŒºåï¼š<code>month=&#39;201910&#39;</code></li>
<li>å°†åˆ†åŒºåä¿®æ”¹ä¸ºï¼š<code>201911</code>åï¼Œåˆ†åŒºæ‰€åœ¨è·¯å¾„ä¸å˜ï¼Œä¾æ—§æ˜¯ï¼š<code>/user/hive/warehouse/test.db/test_table/month=201910</code></li>
</ul>
<p>å¦‚æœå¸Œæœ›ä¿®æ”¹åˆ†åŒºååï¼ŒåŒæ­¥ä¿®æ”¹HDFSçš„è·¯å¾„ï¼Œå¹¶ä¿è¯æ­£å¸¸å¯ç”¨ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>åœ¨å…ƒæ•°æ®åº“ä¸­ï¼š<code>æ‰¾åˆ°SDSè¡¨</code> -&gt; <code>æ‰¾åˆ°LOCATIONåˆ—</code> -&gt; <code>æ‰¾åˆ°å¯¹åº”åˆ†åŒºçš„è·¯å¾„è®°å½•è¿›è¡Œä¿®æ”¹</code><ul>
<li>å¦‚å°†è®°å½•çš„ï¼š<code>/user/hive/warehouse/test.db/test_table/month=201910</code> ä¿®æ”¹ä¸ºï¼š<code>/user/hive/warehouse/test.db/test_table/month=201911</code></li>
</ul>
</li>
<li>åœ¨HDFSä¸­ï¼ŒåŒæ­¥ä¿®æ”¹æ–‡ä»¶å¤¹å<ul>
<li>å¦‚å°†æ–‡ä»¶å¤¹ï¼š<code>/user/hive/warehouse/test.db/test_table/month=201910</code> ä¿®æ”¹ä¸ºï¼š<code>/user/hive/warehouse/test.db/test_table/month=201911</code></li>
</ul>
</li>
</ul>
<p><strong>åˆ é™¤åˆ†åŒº</strong></p>
<pre><code class="sql">ALTER TABLE tablename DROP PARTITION (partition_key=&#39;partition_value&#39;);
</code></pre>
<blockquote>
<p>åˆ é™¤åˆ†åŒºåï¼Œåªæ˜¯åœ¨å…ƒæ•°æ®ä¸­åˆ é™¤ï¼Œå³åˆ é™¤å…ƒæ•°æ®åº“ä¸­ï¼š</p>
<ul>
<li><code>PARTITION</code>è¡¨</li>
<li><code>SDS</code>è¡¨</li>
</ul>
<p>ç›¸å…³è®°å½•</p>
<p>&#x3D;&#x3D;åˆ†åŒºæ‰€åœ¨çš„HDFSæ–‡ä»¶å¤¹ä¾æ—§ä¿ç•™&#x3D;&#x3D;</p>
</blockquote>
<p><strong>åŠ è½½æ•°æ®</strong></p>
<p>LOAD DATA</p>
<pre><code class="sql">LOAD DATA [LOCAL] INPATH &#39;path&#39; INTO TABLE tbl PARTITION(partition_key=&#39;partition_value&#39;);
</code></pre>
<p>åŸºäºhdfsè¿›è¡ŒloadåŠ è½½æ•°æ®ï¼Œæºæ•°æ®æ–‡ä»¶ä¼šæ¶ˆå¤±ï¼ˆæœ¬è´¨ä¸Šæ˜¯è¢«ç§»åŠ¨åˆ°è¡¨æ‰€åœ¨çš„ç›®å½•ä¸­ï¼‰ï¼Œä¸åŠ overwriteæ˜¯æŠŠæ•°æ®è¿½åŠ åˆ°æ•°æ®è¡¨ä¸­</p>
<p>INSERT SELECT</p>
<pre><code class="sql">INSERT (OVERWRITE | INTO) TABLE tbl PARTITION(partition_key=&#39;partition_value&#39;) SELECT ... FROM ...;
</code></pre>
<h3 id="åˆ†æ¡¶æ“ä½œ"><a href="#åˆ†æ¡¶æ“ä½œ" class="headerlink" title="åˆ†æ¡¶æ“ä½œ"></a>åˆ†æ¡¶æ“ä½œ</h3><p><strong>å»ºè¡¨</strong></p>
<pre><code class="sql">CREATE TABLE course (c_id string,c_name string,t_id string) 
    [PARTITION(partition_key=&#39;partition_value&#39;)] 
    CLUSTERED BY(c_id) INTO 3 BUCKETS ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;
</code></pre>
<ul>
<li><code>CLUSTERED BY(col)</code> æŒ‡å®šåˆ†æ¡¶åˆ—</li>
<li><code>INTO 3 BUCKETS</code>ï¼Œè®¾å®š3ä¸ªæ¡¶</li>
</ul>
<blockquote>
<p>åˆ†æ¡¶è¡¨éœ€è¦å¼€å¯ï¼š</p>
<p><code>set hive.enforce.bucketing=true;</code></p>
<p>è®¾ç½®è‡ªåŠ¨åŒ¹é…æ¡¶æ•°é‡çš„reduces taskæ•°é‡</p>
</blockquote>
<p><strong>æ•°æ®åŠ è½½</strong></p>
<pre><code class="sql">INSERT (OVERWRITE | INTO) TABLE tbl 
    [PARTITION(partition_key=&#39;partition_value&#39;)] 
    SELECT ... FROM ... CLUSTER BY(col);
</code></pre>
<p>&#x3D;&#x3D;åˆ†æ¡¶è¡¨æ— æ³•ä½¿ç”¨LOAD DATAè¿›è¡Œæ•°æ®åŠ è½½&#x3D;&#x3D;</p>
<h3 id="æ•°æ®åŠ è½½"><a href="#æ•°æ®åŠ è½½" class="headerlink" title="æ•°æ®åŠ è½½"></a>æ•°æ®åŠ è½½</h3><p><strong>LOAD DATA</strong></p>
<p>å°†æ•°æ®æ–‡ä»¶åŠ è½½åˆ°è¡¨</p>
<pre><code class="sql">LOAD DATA [LOCAL] INPATH &#39;path&#39; INTO TABLE tbl [PARTITION(partition_key=&#39;partition_value&#39;)];	-- æŒ‡å®šåˆ†åŒºå¯é€‰
</code></pre>
<p><strong>INSERT SELECT</strong></p>
<p>å°†å…¶å®ƒè¡¨æ•°æ®ï¼ŒåŠ è½½åˆ°ç›®æ ‡è¡¨</p>
<pre><code class="sql">INSERT (OVERWRITE | INTO) TABLE tbl 
    [PARTITION(partition_key=&#39;partition_value&#39;)] 		-- æŒ‡å®šåˆ†åŒºï¼Œå¯é€‰
    SELECT ... FROM ... [CLUSTER BY(col)];				-- æŒ‡å®šåˆ†æ¡¶åˆ—ï¼Œå¯é€‰
</code></pre>
<h3 id="æ•°æ®å¯¼å‡º"><a href="#æ•°æ®å¯¼å‡º" class="headerlink" title="æ•°æ®å¯¼å‡º"></a>æ•°æ®å¯¼å‡º</h3><p><strong>INSERT OVERWRITE SELECT</strong></p>
<pre><code class="sql">INSERT OVERWRITE [LOCAL] DIRECTORY â€˜pathâ€™ 				-- LOCALå¯é€‰ï¼Œå¸¦LOCALå¯¼å‡ºLinuxæœ¬åœ°ï¼Œä¸å¸¦LOCALå¯¼å‡ºåˆ°HDFS
    [ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;&#39;]		-- å¯é€‰ï¼Œè‡ªå®šä¹‰åˆ—åˆ†éš”ç¬¦
    SELECT ... FROM ...;
</code></pre>
<p><strong>bin&#x2F;hive</strong></p>
<ul>
<li><code>bin/hive -e &#39;sql&#39; &gt; export_file</code> å°†<code>sql</code>ç»“æœé‡å®šå‘åˆ°å¯¼å‡ºæ–‡ä»¶ä¸­</li>
<li><code>bin/hive -f &#39;sql_script_file&#39; &gt; export_file</code> å°†<code>sqlè„šæœ¬</code>æ‰§è¡Œçš„ç»“æœé‡å®šå‘åˆ°å¯¼å‡ºæ–‡ä»¶ä¸­</li>
</ul>
<h3 id="å¤æ‚ç±»å‹"><a href="#å¤æ‚ç±»å‹" class="headerlink" title="å¤æ‚ç±»å‹"></a>å¤æ‚ç±»å‹</h3><table>
<thead>
<tr>
<th><strong>ç±»å‹</strong></th>
<th><strong>å®šä¹‰</strong></th>
<th><strong>ç¤ºä¾‹</strong></th>
<th><strong>å†…å«å…ƒç´ ç±»å‹</strong></th>
<th><strong>å…ƒç´ ä¸ªæ•°</strong></th>
<th><strong>å–å…ƒç´ </strong></th>
<th><strong>å¯ç”¨å‡½æ•°</strong></th>
</tr>
</thead>
<tbody><tr>
<td>array</td>
<td>array&lt;ç±»å‹&gt;</td>
<td>å¦‚å®šä¹‰ä¸ºarray<int>æ•°æ®ä¸ºï¼š1,2,3,4,5</td>
<td>å•å€¼ï¼Œç±»å‹å–å†³äºå®šä¹‰</td>
<td>åŠ¨æ€ï¼Œä¸é™åˆ¶</td>
<td>array[æ•°å­—åºå·] åºå·ä»0å¼€å§‹</td>
<td>sizeç»Ÿè®¡å…ƒç´ ä¸ªæ•° array_containsåˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šæ•°æ®</td>
</tr>
<tr>
<td>map</td>
<td>map&lt;keyç±»å‹, valueç±»å‹&gt;</td>
<td>å¦‚å®šä¹‰ä¸ºï¼šmap&lt;string, int&gt;æ•°æ®ä¸ºï¼š{â€™aâ€™: 1, â€˜bâ€™: 2, â€˜câ€™: 3}</td>
<td>é”®å€¼å¯¹ï¼ŒK-Vï¼ŒKå’ŒVç±»å‹å–å†³äºå®šä¹‰</td>
<td>åŠ¨æ€ï¼Œä¸é™åˆ¶</td>
<td>map[key] å–å‡ºå¯¹åº”keyçš„value</td>
<td>sizeç»Ÿè®¡å…ƒç´ ä¸ªæ•°array_containsåˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šæ•°æ® map_keyså–å‡ºå…¨éƒ¨keyï¼Œè¿”å›array map_valueså–å‡ºå…¨éƒ¨valuesï¼Œè¿”å›array</td>
</tr>
<tr>
<td>struct</td>
<td>struct&lt;å­åˆ—å ç±»å‹, å­åˆ—å ç±»å‹â€¦&gt;</td>
<td>å¦‚å®šä¹‰ä¸ºï¼šstruct&lt;c1 string, c2 int, c3 date&gt;æ•°æ®ä¸ºï¼šâ€™aâ€™, 1, â€˜2000-01-01â€™</td>
<td>å•å€¼ï¼Œç±»å‹å–å†³äºå®šä¹‰</td>
<td>å›ºå®šï¼Œå–å†³äºå®šä¹‰çš„å­åˆ—æ•°é‡</td>
<td>struct.å­åˆ—å é€šè¿‡å­åˆ—åå–å‡ºå­åˆ—å€¼</td>
<td>æš‚æ— </td>
</tr>
</tbody></table>
<h2 id="æ•°æ®æŸ¥è¯¢çš„è¯¾å ‚SQLè®°å½•"><a href="#æ•°æ®æŸ¥è¯¢çš„è¯¾å ‚SQLè®°å½•" class="headerlink" title="æ•°æ®æŸ¥è¯¢çš„è¯¾å ‚SQLè®°å½•"></a>æ•°æ®æŸ¥è¯¢çš„è¯¾å ‚SQLè®°å½•</h2><h3 id="åŸºæœ¬æŸ¥è¯¢"><a href="#åŸºæœ¬æŸ¥è¯¢" class="headerlink" title="åŸºæœ¬æŸ¥è¯¢"></a>åŸºæœ¬æŸ¥è¯¢</h3><pre><code class="sql">create database itheima;
use itheima;
CREATE TABLE itheima.orders (
    orderId bigint COMMENT &#39;è®¢å•id&#39;,
    orderNo string COMMENT &#39;è®¢å•ç¼–å·&#39;,
    shopId bigint COMMENT &#39;é—¨åº—id&#39;,
    userId bigint COMMENT &#39;ç”¨æˆ·id&#39;,
    orderStatus tinyint COMMENT &#39;è®¢å•çŠ¶æ€ -3:ç”¨æˆ·æ‹’æ”¶ -2:æœªä»˜æ¬¾çš„è®¢å• -1ï¼šç”¨æˆ·å–æ¶ˆ 0:å¾…å‘è´§ 1:é…é€ä¸­ 2:ç”¨æˆ·ç¡®è®¤æ”¶è´§&#39;,
    goodsMoney double COMMENT &#39;å•†å“é‡‘é¢&#39;,
    deliverMoney double COMMENT &#39;è¿è´¹&#39;,
    totalMoney double COMMENT &#39;è®¢å•é‡‘é¢ï¼ˆåŒ…æ‹¬è¿è´¹ï¼‰&#39;,
    realTotalMoney double COMMENT &#39;å®é™…è®¢å•é‡‘é¢ï¼ˆæŠ˜æ‰£åé‡‘é¢ï¼‰&#39;,
    payType tinyint COMMENT &#39;æ”¯ä»˜æ–¹å¼,0:æœªçŸ¥;1:æ”¯ä»˜å®ï¼Œ2ï¼šå¾®ä¿¡;3ã€ç°é‡‘ï¼›4ã€å…¶ä»–&#39;,
    isPay tinyint COMMENT &#39;æ˜¯å¦æ”¯ä»˜ 0:æœªæ”¯ä»˜ 1:å·²æ”¯ä»˜&#39;,
    userName string COMMENT &#39;æ”¶ä»¶äººå§“å&#39;,
    userAddress string COMMENT &#39;æ”¶ä»¶äººåœ°å€&#39;,
    userPhone string COMMENT &#39;æ”¶ä»¶äººç”µè¯&#39;,
    createTime timestamp COMMENT &#39;ä¸‹å•æ—¶é—´&#39;,
    payTime timestamp COMMENT &#39;æ”¯ä»˜æ—¶é—´&#39;,
    totalPayFee int COMMENT &#39;æ€»æ”¯ä»˜é‡‘é¢&#39;
) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;

load data local inpath &#39;/home/hadoop/itheima_orders.txt&#39; into table itheima.orders;

CREATE TABLE itheima.users (
    userId int,
    loginName string,
    loginSecret int,
    loginPwd string,
    userSex tinyint,
    userName string,
    trueName string,
    brithday date,
    userPhoto string,
    userQQ string,
    userPhone string,
    userScore int,
    userTotalScore int,
    userFrom tinyint,
    userMoney double,
    lockMoney double,
    createTime timestamp,
    payPwd string,
    rechargeMoney double
) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;

load data local inpath &#39;/home/hadoop/itheima_users.txt&#39; into table itheima.users;

-- æŸ¥è¯¢å…¨è¡¨æ•°æ®
SELECT * FROM itheima.orders;

-- æŸ¥è¯¢å•åˆ—ä¿¡æ¯
SELECT orderid, userid, totalmoney FROM itheima.orders o ;

-- æŸ¥è¯¢è¡¨æœ‰å¤šå°‘æ¡æ•°æ®
SELECT COUNT(*) FROM itheima.orders;

-- è¿‡æ»¤å¹¿ä¸œçœçš„è®¢å•
SELECT * FROM itheima.orders WHERE useraddress LIKE &#39;%å¹¿ä¸œ%&#39;;

-- æ‰¾å‡ºå¹¿ä¸œçœå•ç¬”è¥ä¸šé¢æœ€å¤§çš„è®¢å•
SELECT * FROM itheima.orders WHERE useraddress LIKE &#39;%å¹¿ä¸œ%&#39;
ORDER BY totalmoney DESC LIMIT 1;

-- ç»Ÿè®¡æœªæ”¯ä»˜ã€å·²æ”¯ä»˜å„è‡ªçš„äººæ•°
SELECT ispay, COUNT(*) FROM itheima.orders o GROUP BY ispay ;

-- åœ¨å·²ä»˜æ¬¾çš„è®¢å•ä¸­ï¼Œç»Ÿè®¡æ¯ä¸ªç”¨æˆ·æœ€é«˜çš„ä¸€ç¬”æ¶ˆè´¹é‡‘é¢
SELECT userid, MAX(totalmoney) FROM itheima.orders WHERE ispay = 1 GROUP BY userid;
-- ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„å¹³å‡è®¢å•æ¶ˆè´¹é¢
SELECT userid, AVG(totalmoney) FROM itheima.orders GROUP BY userid;
-- ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„å¹³å‡è®¢å•æ¶ˆè´¹é¢ï¼Œå¹¶è¿‡æ»¤å¤§äº10000çš„æ•°æ®
SELECT userid, AVG(totalmoney) AS avg_money FROM itheima.orders GROUP BY userid HAVING avg_money &gt; 10000;

-- è®¢å•è¡¨å’Œç”¨æˆ·è¡¨JOIN æ‰¾å‡ºç”¨æˆ·username
SELECT o.orderid, o.userid, u.username FROM itheima.orders o JOIN itheima.users u ON o.userid = u.userid;
SELECT o.orderid, o.userid, u.username FROM itheima.orders o LEFT JOIN itheima.users u ON o.userid = u.userid;
</code></pre>
<h3 id="RLIKE"><a href="#RLIKE" class="headerlink" title="RLIKE"></a>RLIKE</h3><p><img src="https://image-set.oss-cn-zhangjiakou.aliyuncs.com/img-out/2023/02/24/20230224234706.png" alt="image-20230224234706719"></p>
<p><img src="https://image-set.oss-cn-zhangjiakou.aliyuncs.com/img-out/2023/02/24/20230224234719.png" alt="image-20230224234719463"></p>
<p><img src="https://image-set.oss-cn-zhangjiakou.aliyuncs.com/img-out/2023/02/24/20230224234733.png" alt="image-20230224234733895"></p>
<pre><code class="sql">-- æŸ¥æ‰¾å¹¿ä¸œçœæ•°æ®
SELECT * FROM itheima.orders WHERE useraddress RLIKE &#39;.*å¹¿ä¸œ.*&#39;;
-- æŸ¥æ‰¾ç”¨æˆ·åœ°å€æ˜¯ï¼šxxçœ xxå¸‚ xxåŒº
SELECT * FROM itheima.orders WHERE useraddress RLIKE &#39;..çœ ..å¸‚ ..åŒº&#39;;
-- æŸ¥æ‰¾ç”¨æˆ·å§“ä¸ºï¼šå¼ ã€ç‹ã€é‚“
SELECT * FROM itheima.orders WHERE username RLIKE &#39;[å¼ ç‹é‚“]\\S+&#39;;
-- æŸ¥æ‰¾æ‰‹æœºå·ç¬¦åˆï¼š188****0*** è§„åˆ™
SELECT * FROM itheima.orders WHERE userphone RLIKE &#39;188\\S&#123;4&#125;0[0-9]&#123;3&#125;&#39;;
</code></pre>
<h3 id="UNIONè”åˆ"><a href="#UNIONè”åˆ" class="headerlink" title="UNIONè”åˆ"></a>UNIONè”åˆ</h3><pre><code class="sql">CREATE TABLE itheima.course(
c_id string, 
c_name string, 
t_id string)
ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39;;

LOAD DATA LOCAL INPATH &#39;/home/hadoop/course.txt&#39; INTO TABLE itheima.course;
-- åŸºç¡€UNION
SELECT * FROM itheima.course WHERE t_id = &#39;å‘¨æ°è½®&#39;
    UNION
SELECT * FROM itheima.course WHERE t_id = &#39;ç‹åŠ›é¸¿&#39;;
-- å»é‡æ¼”ç¤º
SELECT * FROM itheima.course
    UNION
SELECT * FROM itheima.course;
-- ä¸å»é‡
SELECT * FROM itheima.course
    UNION ALL
SELECT * FROM itheima.course;
-- UNIONå†™åœ¨FROMä¸­ UNIONå†™åœ¨å­æŸ¥è¯¢ä¸­
SELECT t_id, COUNT(*) FROM 
(
    SELECT * FROM itheima.course WHERE t_id = &#39;å‘¨æ°è½®&#39;
        UNION ALL
    SELECT * FROM itheima.course WHERE t_id = &#39;ç‹åŠ›é¸¿&#39; 
) AS u GROUP BY t_id;

-- ç”¨äºINSERT SELECT
INSERT OVERWRITE TABLE itheima.course2
SELECT * FROM itheima.course 
    UNION
SELECT * FROM itheima.course;
</code></pre>
<h3 id="Samplingé‡‡æ ·"><a href="#Samplingé‡‡æ ·" class="headerlink" title="Samplingé‡‡æ ·"></a>Samplingé‡‡æ ·</h3><pre><code class="sql"># éšæœºæ¡¶æŠ½å–ï¼Œ åˆ†é…æ¡¶æ˜¯æœ‰è§„åˆ™çš„
# å¯ä»¥æŒ‰ç…§åˆ—çš„hashå–æ¨¡åˆ†æ¡¶
# æŒ‰ç…§å®Œå…¨éšæœºåˆ†æ¡¶
-- å…¶å®ƒæ¡ä»¶ä¸å˜çš„è¯ï¼Œæ¯ä¸€æ¬¡è¿è¡Œç»“æœä¸€è‡´
select username, orderId, totalmoney FROM itheima.orders 
    tablesample(bucket 3 out of 10 on username);
    
-- å®Œå…¨éšæœºï¼Œæ¯ä¸€æ¬¡è¿è¡Œç»“æœä¸åŒ
select * from itheima.orders 
    tablesample(bucket 3 out of 10 on rand());
    


# æ•°æ®å—æŠ½å–ï¼ŒæŒ‰é¡ºåºæŠ½å–ï¼Œæ¯æ¬¡æ¡ä»¶ä¸å˜ï¼ŒæŠ½å–ç»“æœä¸å˜
-- æŠ½å–100æ¡
select * from itheima.orders
    tablesample(100 rows);
    
-- å–1%æ•°æ®
select * from itheima.orders
    tablesample(1 percent);
    
-- å– 1KBæ•°æ®
select * from itheima.orders
    tablesample(1K);
</code></pre>
<h3 id="è™šæ‹Ÿåˆ—"><a href="#è™šæ‹Ÿåˆ—" class="headerlink" title="è™šæ‹Ÿåˆ—"></a>è™šæ‹Ÿåˆ—</h3><p>è™šæ‹Ÿåˆ—æ˜¯Hiveå†…ç½®çš„å¯ä»¥åœ¨æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ ‡è®°ï¼Œå¯ä»¥æŸ¥è¯¢æ•°æ®æœ¬èº«çš„è¯¦ç»†å‚æ•°ã€‚</p>
<p>Hiveç›®å‰å¯ç”¨3ä¸ªè™šæ‹Ÿåˆ—ï¼š</p>
<pre><code class="shell">- INPUT__FILE__NAMEï¼Œæ˜¾ç¤ºæ•°æ®è¡Œæ‰€åœ¨çš„å…·ä½“æ–‡ä»¶
- BLOCK__OFFSET__INSIDE__FILEï¼Œæ˜¾ç¤ºæ•°æ®è¡Œæ‰€åœ¨æ–‡ä»¶çš„åç§»é‡
- ROW__OFFSET__INSIDE__BLOCKï¼Œæ˜¾ç¤ºæ•°æ®æ‰€åœ¨HDFSå—çš„åç§»é‡
  æ­¤è™šæ‹Ÿåˆ—éœ€è¦è®¾ç½®ï¼šSET hive.exec.rowoffset=true æ‰å¯ä½¿ç”¨
</code></pre>
<pre><code class="sql">SET hive.exec.rowoffset=true;

SELECT orderid, username, INPUT__FILE__NAME, BLOCK__OFFSET__INSIDE__FILE, ROW__OFFSET__INSIDE__BLOCK FROM itheima.orders;

SELECT *, BLOCK__OFFSET__INSIDE__FILE FROM itheima.orders WHERE BLOCK__OFFSET__INSIDE__FILE &lt; 1000;

SELECT orderid, username, INPUT__FILE__NAME, BLOCK__OFFSET__INSIDE__FILE, ROW__OFFSET__INSIDE__BLOCK FROM itheima.orders_bucket;

SELECT INPUT__FILE__NAME, COUNT(*) FROM itheima.orders_bucket GROUP BY INPUT__FILE__NAME;
</code></pre>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>æ•°å€¼ã€é›†åˆã€è½¬æ¢ã€æ—¥æœŸå‡½æ•°</p>
<pre><code class="sql">-- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‡½æ•°
show functions;
-- æŸ¥çœ‹å‡½æ•°ä½¿ç”¨æ–¹å¼
describe function extended count;
-- æ•°å€¼å‡½æ•°
-- round å–æ•´ï¼Œè®¾ç½®å°æ•°ç²¾åº¦
select round(3.1415926);		-- å–æ•´(å››èˆäº”å…¥)
select round(3.1415926, 4);		-- è®¾ç½®å°æ•°ç²¾åº¦4ä½(å››èˆäº”å…¥)
-- éšæœºæ•°
select rand();					-- å®Œå…¨éšæœº
select rand(3);					-- è®¾ç½®éšæœºæ•°ç§å­ï¼Œè®¾ç½®ç§å­åæ¯æ¬¡è¿è¡Œç»“æœä¸€è‡´çš„
-- ç»å¯¹å€¼
select abs(-3);
-- æ±‚PI
select pi();

-- é›†åˆå‡½æ•°
-- æ±‚å…ƒç´ ä¸ªæ•°
select size(work_locations) from test_array;
select size(members) from test_map;
-- å–å‡ºmapçš„å…¨éƒ¨key
select map_keys(members) from test_map;
-- å–å‡ºmapçš„å…¨éƒ¨value
select map_values(members) from test_map;
-- æŸ¥è¯¢arrayå†…æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ ï¼Œæ˜¯å°±è¿”å›True
select * from test_array where ARRAY_CONTAINS(work_locations, &#39;tianjin&#39;);
-- æ’åº
select *, sort_array(work_locations) from test_array;


-- ç±»å‹è½¬æ¢å‡½æ•°
-- è½¬äºŒè¿›åˆ¶
select binary(&#39;hadoop&#39;);
-- è‡ªç”±è½¬æ¢ï¼Œç±»å‹è½¬æ¢å¤±è´¥æŠ¥é”™æˆ–è¿”å›NULL
select cast(&#39;1&#39; as bigint);

-- æ—¥æœŸå‡½æ•°
-- å½“å‰æ—¶é—´æˆ³
select current_timestamp();
-- å½“å‰æ—¥æœŸ
select current_date();
-- æ—¶é—´æˆ³è½¬æ—¥æœŸ
select to_date(current_timestamp());
-- å¹´æœˆæ—¥å­£åº¦ç­‰
select year(&#39;2020-01-11&#39;);
select month(&#39;2020-01-11&#39;);
select day(&#39;2020-01-11&#39;);
select quarter(&#39;2020-05-11&#39;);
select dayofmonth(&#39;2020-05-11&#39;);
select hour(&#39;2020-05-11 10:36:59&#39;);
select minute(&#39;2020-05-11 10:36:59&#39;);
select second(&#39;2020-05-11 10:36:59&#39;);
select weekofyear(&#39;2020-05-11 10:36:59&#39;);
-- æ—¥æœŸä¹‹é—´çš„å¤©æ•°
select datediff(&#39;2022-12-31&#39;, &#39;2019-12-31&#39;);
-- æ—¥æœŸç›¸åŠ ã€ç›¸å‡
select date_add(&#39;2022-12-31&#39;, 5);
select date_sub(&#39;2022-12-31&#39;, 5);
</code></pre>
<h2 id="ç¤¾äº¤æ¡ˆä¾‹æ“ä½œSQL"><a href="#ç¤¾äº¤æ¡ˆä¾‹æ“ä½œSQL" class="headerlink" title="ç¤¾äº¤æ¡ˆä¾‹æ“ä½œSQL"></a>ç¤¾äº¤æ¡ˆä¾‹æ“ä½œSQL</h2><p>å‡†å¤‡æ•°æ®</p>
<pre><code class="sql">-- åˆ›å»ºæ•°æ®åº“
create database db_msg;
-- é€‰æ‹©æ•°æ®åº“
use db_msg;

-- å¦‚æœè¡¨å·²å­˜åœ¨å°±åˆ é™¤
drop table if exists db_msg.tb_msg_source ;
-- å»ºè¡¨
create table db_msg.tb_msg_source(
    msg_time string comment &quot;æ¶ˆæ¯å‘é€æ—¶é—´&quot;,
    sender_name string comment &quot;å‘é€äººæ˜µç§°&quot;,
    sender_account string comment &quot;å‘é€äººè´¦å·&quot;,
    sender_sex string comment &quot;å‘é€äººæ€§åˆ«&quot;,
    sender_ip string comment &quot;å‘é€äººipåœ°å€&quot;,
    sender_os string comment &quot;å‘é€äººæ“ä½œç³»ç»Ÿ&quot;,
    sender_phonetype string comment &quot;å‘é€äººæ‰‹æœºå‹å·&quot;,
    sender_network string comment &quot;å‘é€äººç½‘ç»œç±»å‹&quot;,
    sender_gps string comment &quot;å‘é€äººçš„GPSå®šä½&quot;,
    receiver_name string comment &quot;æ¥æ”¶äººæ˜µç§°&quot;,
    receiver_ip string comment &quot;æ¥æ”¶äººIP&quot;,
    receiver_account string comment &quot;æ¥æ”¶äººè´¦å·&quot;,
    receiver_os string comment &quot;æ¥æ”¶äººæ“ä½œç³»ç»Ÿ&quot;,
    receiver_phonetype string comment &quot;æ¥æ”¶äººæ‰‹æœºå‹å·&quot;,
    receiver_network string comment &quot;æ¥æ”¶äººç½‘ç»œç±»å‹&quot;,
    receiver_gps string comment &quot;æ¥æ”¶äººçš„GPSå®šä½&quot;,
    receiver_sex string comment &quot;æ¥æ”¶äººæ€§åˆ«&quot;,
    msg_type string comment &quot;æ¶ˆæ¯ç±»å‹&quot;,
    distance string comment &quot;åŒæ–¹è·ç¦»&quot;,
    message string comment &quot;æ¶ˆæ¯å†…å®¹&quot;
);

-- ä¸Šä¼ æ•°æ®åˆ°HDFS(Linuxå‘½ä»¤)
hadoop fs -mkdir -p /chatdemo/data
hadoop fs -put chat_data-30W.csv /chatdemo/data/

-- åŠ è½½æ•°æ®åˆ°è¡¨ä¸­ï¼ŒåŸºäºHDFSåŠ è½½
load data inpath &#39;/chatdemo/data/chat_data-30W.csv&#39; into table tb_msg_source;

-- éªŒè¯æ•°æ®åŠ è½½
select * from tb_msg_source tablesample(100 rows);
-- éªŒè¯ä¸€ä¸‹è¡¨çš„æ•°é‡
select count(*) from tb_msg_source;
</code></pre>
<p>ETLæ¸…æ´—è½¬æ¢</p>
<pre><code class="sql">create table db_msg.tb_msg_etl(
    msg_time string comment &quot;æ¶ˆæ¯å‘é€æ—¶é—´&quot;,
    sender_name string comment &quot;å‘é€äººæ˜µç§°&quot;,
    sender_account string comment &quot;å‘é€äººè´¦å·&quot;,
    sender_sex string comment &quot;å‘é€äººæ€§åˆ«&quot;,
    sender_ip string comment &quot;å‘é€äººipåœ°å€&quot;,
    sender_os string comment &quot;å‘é€äººæ“ä½œç³»ç»Ÿ&quot;,
    sender_phonetype string comment &quot;å‘é€äººæ‰‹æœºå‹å·&quot;,
    sender_network string comment &quot;å‘é€äººç½‘ç»œç±»å‹&quot;,
    sender_gps string comment &quot;å‘é€äººçš„GPSå®šä½&quot;,
    receiver_name string comment &quot;æ¥æ”¶äººæ˜µç§°&quot;,
    receiver_ip string comment &quot;æ¥æ”¶äººIP&quot;,
    receiver_account string comment &quot;æ¥æ”¶äººè´¦å·&quot;,
    receiver_os string comment &quot;æ¥æ”¶äººæ“ä½œç³»ç»Ÿ&quot;,
    receiver_phonetype string comment &quot;æ¥æ”¶äººæ‰‹æœºå‹å·&quot;,
    receiver_network string comment &quot;æ¥æ”¶äººç½‘ç»œç±»å‹&quot;,
    receiver_gps string comment &quot;æ¥æ”¶äººçš„GPSå®šä½&quot;,
    receiver_sex string comment &quot;æ¥æ”¶äººæ€§åˆ«&quot;,
    msg_type string comment &quot;æ¶ˆæ¯ç±»å‹&quot;,
    distance string comment &quot;åŒæ–¹è·ç¦»&quot;,
    message string comment &quot;æ¶ˆæ¯å†…å®¹&quot;,
    msg_day string comment &quot;æ¶ˆæ¯æ—¥&quot;,
    msg_hour string comment &quot;æ¶ˆæ¯å°æ—¶&quot;,
    sender_lng double comment &quot;ç»åº¦&quot;,
    sender_lat double comment &quot;çº¬åº¦&quot;
);

INSERT OVERWRITE TABLE db_msg.tb_msg_etl
SELECT 
    *, 
    DATE(msg_time) AS msg_day, 
    HOUR(msg_time) AS msg_hour, 
    SPLIT(sender_gps, &#39;,&#39;)[0] AS sender_lng, 
    SPLIT(sender_gps, &#39;,&#39;)[1] AS sender_lat
FROM db_msg.tb_msg_source
WHERE LENGTH(sender_gps) &gt; 0;
</code></pre>
<p>æŒ‡æ ‡è®¡ç®—</p>
<p>éœ€æ±‚1</p>
<pre><code class="sql">--ä¿å­˜ç»“æœè¡¨
CREATE TABLE IF NOT EXISTS tb_rs_total_msg_cnt 
COMMENT &quot;æ¯æ—¥æ¶ˆæ¯æ€»é‡&quot; AS 
SELECT 
    msg_day, 
    COUNT(*) AS total_msg_cnt 
FROM db_msg.tb_msg_etl 
GROUP BY msg_day;
</code></pre>
<p>éœ€æ±‚2</p>
<pre><code class="sql">--ä¿å­˜ç»“æœè¡¨
CREATE TABLE IF NOT EXISTS tb_rs_hour_msg_cnt 
COMMENT &quot;æ¯å°æ—¶æ¶ˆæ¯é‡è¶‹åŠ¿&quot; AS  
SELECT  
    msg_hour, 
    COUNT(*) AS total_msg_cnt, 
    COUNT(DISTINCT sender_account) AS sender_user_cnt, 
    COUNT(DISTINCT receiver_account) AS receiver_user_cnt
FROM db_msg.tb_msg_etl GROUP BY msg_hour;
</code></pre>
<p>éœ€æ±‚3</p>
<pre><code class="sql">CREATE TABLE IF NOT EXISTS tb_rs_loc_cnt
COMMENT &#39;ä»Šæ—¥å„åœ°åŒºå‘é€æ¶ˆæ¯æ€»é‡&#39; AS 
SELECT 
    msg_day,  
    sender_lng, 
    sender_lat, 
    COUNT(*) AS total_msg_cnt 
FROM db_msg.tb_msg_etl
GROUP BY msg_day, sender_lng, sender_lat;
</code></pre>
<p>éœ€æ±‚4</p>
<pre><code class="sql">--ä¿å­˜ç»“æœè¡¨
CREATE TABLE IF NOT EXISTS tb_rs_user_cnt
COMMENT &quot;ä»Šæ—¥å‘é€æ¶ˆæ¯äººæ•°ã€æ¥å—æ¶ˆæ¯äººæ•°&quot; AS
SELECT 
msg_day, 
COUNT(DISTINCT sender_account) AS sender_user_cnt, 
COUNT(DISTINCT receiver_account) AS receiver_user_cnt
FROM db_msg.tb_msg_etl
GROUP BY msg_day;
</code></pre>
<p>éœ€æ±‚5</p>
<pre><code class="sql">--ä¿å­˜ç»“æœè¡¨
CREATE TABLE IF NOT EXISTS db_msg.tb_rs_s_user_top10
COMMENT &quot;å‘é€æ¶ˆæ¯æ¡æ•°æœ€å¤šçš„Top10ç”¨æˆ·&quot; AS
SELECT 
    sender_name AS username, 
    COUNT(*) AS sender_msg_cnt 
FROM db_msg.tb_msg_etl 
GROUP BY sender_name 
ORDER BY sender_msg_cnt DESC 
LIMIT 10;
</code></pre>
<p>éœ€æ±‚6</p>
<pre><code class="sql">CREATE TABLE IF NOT EXISTS db_msg.tb_rs_r_user_top10
COMMENT &quot;æ¥æ”¶æ¶ˆæ¯æ¡æ•°æœ€å¤šçš„Top10ç”¨æˆ·&quot; AS
SELECT 
receiver_name AS username, 
COUNT(*) AS receiver_msg_cnt 
FROM db_msg.tb_msg_etl 
GROUP BY receiver_name 
ORDER BY receiver_msg_cnt DESC 
LIMIT 10;
</code></pre>
<p>éœ€æ±‚7</p>
<pre><code class="sql">CREATE TABLE IF NOT EXISTS db_msg.tb_rs_sender_phone
COMMENT &quot;å‘é€äººçš„æ‰‹æœºå‹å·åˆ†å¸ƒ&quot; AS
SELECT 
    sender_phonetype, 
    COUNT(sender_account) AS cnt 
FROM db_msg.tb_msg_etl 
GROUP BY sender_phonetype;
</code></pre>
<p>éœ€æ±‚8</p>
<pre><code class="sql">--ä¿å­˜ç»“æœè¡¨
CREATE TABLE IF NOT EXISTS db_msg.tb_rs_sender_os
COMMENT &quot;å‘é€äººçš„OSåˆ†å¸ƒ&quot; AS
SELECT
    sender_os, 
    COUNT(sender_account) AS cnt 
FROM db_msg.tb_msg_etl 
GROUP BY sender_os
</code></pre>
<h2 id="Hiveåˆ—æ³¨é‡Šã€è¡¨æ³¨é‡Šç­‰ä¹±ç è§£å†³æ–¹æ¡ˆ"><a href="#Hiveåˆ—æ³¨é‡Šã€è¡¨æ³¨é‡Šç­‰ä¹±ç è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Hiveåˆ—æ³¨é‡Šã€è¡¨æ³¨é‡Šç­‰ä¹±ç è§£å†³æ–¹æ¡ˆ"></a>Hiveåˆ—æ³¨é‡Šã€è¡¨æ³¨é‡Šç­‰ä¹±ç è§£å†³æ–¹æ¡ˆ</h2><pre><code class="sql">-- åœ¨Hiveçš„MySQLå…ƒæ•°æ®åº“ä¸­æ‰§è¡Œ
use hive;

1).ä¿®æ”¹å­—æ®µæ³¨é‡Šå­—ç¬¦é›†

alter table COLUMNS_V2 modify column COMMENT varchar(256) character set utf8;
2).ä¿®æ”¹è¡¨æ³¨é‡Šå­—ç¬¦é›†

alter table TABLE_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
3).ä¿®æ”¹åˆ†åŒºè¡¨å‚æ•°ï¼Œä»¥æ”¯æŒåˆ†åŒºé”®èƒ½å¤Ÿç”¨ä¸­æ–‡è¡¨ç¤º

alter table PARTITION_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
alter table PARTITION_KEYS modify column PKEY_COMMENT varchar(4000) character set utf8;
4).ä¿®æ”¹ç´¢å¼•æ³¨è§£

mysql&gt;alter table INDEX_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
</code></pre>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚ </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2023 Mhen
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("black_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
